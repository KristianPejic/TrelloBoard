<div class="board-name">
  <h1>{{ boardName }}</h1>
</div>
<div class="return-button-container">
  <button class="return-button" (click)="navigateToBoardSelection()">
    ← Back to Boards
  </button>
</div>
<div class="progress-container">
  <div class="progress-bar" [style.width]="progress + '%'"></div>
  <p>{{ progress | number : "1.0-2" }}% Complete</p>
</div>
<div class="task-board">
  <div
    class="task-columns"
    cdkDropList
    [cdkDropListData]="dynamicColumns"
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="dropColumn($event)"
  >
    <div
      id="to-do-list"
      class="task-column"
      cdkDropList
      [cdkDropListData]="toDoTasks"
      [cdkDropListConnectedTo]="['doing-list', 'done-list']"
      (cdkDropListDropped)="drop($event, 'To do')"
    >
      <h3>To Do</h3>
      <div class="task" *ngFor="let task of toDoTasks" cdkDrag>
        <div class="task-content">
          <input *ngIf="task.isEditing" [(ngModel)]="task.title" />
          <span class="task-title" *ngIf="!task.isEditing">{{
            task.title
          }}</span>
          <div class="task-actions">
            <button class="edit-btn" (click)="toggleEdit(task)">✏️</button>
            <button
              *ngIf="task.isEditing"
              class="save-edit-btn"
              (click)="saveEdit(task)"
            >
              Save
            </button>
            <button class="delete-btn" (click)="deleteTask(task)">🗑</button>
          </div>
        </div>
      </div>
      <div class="add-task-container">
        <button class="add-task-btn" (click)="showInput = !showInput">
          + Add Task
        </button>
        <div *ngIf="showInput" class="add-task-form">
          <input [(ngModel)]="newTaskTitle" placeholder="Task name" />
          <div class="button-group">
            <button (click)="addTask()">Save</button>
            <button (click)="showInput = false">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <div
      id="doing-list"
      class="task-column"
      cdkDropList
      [cdkDropListData]="doingTasks"
      [cdkDropListConnectedTo]="['to-do-list', 'done-list']"
      (cdkDropListDropped)="drop($event, 'Doing')"
    >
      <h3>Doing</h3>
      <div class="task" *ngFor="let task of doingTasks" cdkDrag>
        <div class="task-content">
          <input *ngIf="task.isEditing" [(ngModel)]="task.title" />
          <span class="task-title" *ngIf="!task.isEditing">{{
            task.title
          }}</span>
          <div class="task-actions">
            <button class="edit-btn" (click)="toggleEdit(task)">✏️</button>
            <button
              *ngIf="task.isEditing"
              class="save-edit-btn"
              (click)="saveEdit(task)"
            >
              Save
            </button>
            <button class="delete-btn" (click)="deleteTask(task)">🗑</button>
          </div>
        </div>
      </div>
    </div>

    <div
      id="done-list"
      class="task-column"
      cdkDropList
      [cdkDropListData]="doneTasks"
      [cdkDropListConnectedTo]="['to-do-list', 'doing-list']"
      (cdkDropListDropped)="drop($event, 'Done')"
    >
      <h3>Done</h3>
      <div class="task" *ngFor="let task of doneTasks" cdkDrag>
        <div class="task-content">
          <input *ngIf="task.isEditing" [(ngModel)]="task.title" />
          <span class="task-title" *ngIf="!task.isEditing">{{
            task.title
          }}</span>
          <div class="task-actions">
            <button class="edit-btn" (click)="toggleEdit(task)">✏️</button>
            <button
              *ngIf="task.isEditing"
              class="save-edit-btn"
              (click)="saveEdit(task)"
            >
              Save
            </button>
            <button class="delete-btn" (click)="deleteTask(task)">🗑</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
